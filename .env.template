# Archivo de variables de entorno y guía rápida para el administrador
# ---------------------------------------------------------------
# Este archivo sirve como plantilla (.env.template) y contiene ejemplos
# de variables de entorno necesarias para ejecutar y desplegar el proyecto.
# Además a continuación encontrarás una guía paso a paso para subir y
# configurar la aplicación tanto en entorno de desarrollo como en producción.

# ------------------------
# EJEMPLO: Entorno LOCAL
# ------------------------
DB_USER=postgres
DB_NAME=portal_de_fincas
DB_PASSWORD= #Colocar contraseña
DATABASE_URL="postgresql://${DB_USER}:${DB_PASSWORD}@localhost:5432/${DB_NAME}?schema=public"

# Configuración de NextAuth (desarrollo local)
# - NEXTAUTH_URL: URL pública que usas para acceder (dev: http://127.0.0.1:3000)
# - NEXTAUTH_SECRET / AUTH_SECRET: secreto para firmar cookies/JWT (genera uno en producción)
AUTH_SECRET='qmgAwq/6F6ZNmSpKcRiEzMwY9q8P6ETyQwuaoOMQrXc='
NEXTAUTH_URL="http://127.0.0.1:3000"
NEXTAUTH_URL_INTERNAL="http://127.0.0.1:3000"
NEXTAUTH_SECRET='qmgAwq/6F6ZNmSpKcRiEzMwY9q8P6ETyQwuaoOMQrXc='

# Lista de hosts permitidos por NextAuth (separados por comas)
NEXTAUTH_TRUSTED_HOSTS="127.0.0.1,localhost"


# =========================
# GUÍA DE DESPLIEGUE (ADMIN) - PASO A PASO
# =========================

# 1) Preparar el servidor
# -----------------------------------------------------------
# - Asegúrate de tener Node.js (>=16), npm/yarn, Git y OpenSSL instalados.

# 2) Clonar el repositorio y configurar .env
# ------------------------------------------
# En el servidor, dentro de la carpeta donde quieras desplegar:
#
# bash (Linux/macOS):
#   git clone <tu-repo.git> portal-web
#   cd portal-web
#   cp .env.template.rename .env
#
# powershell (Windows):
#   git clone <tu-repo.git> portal-web
#   cd portal-web
#   Copy-Item .env.template.rename .env

# Edita el fichero `.env` con valores apropiados para producción.

# 3) Elegir y configurar la base de datos
# ---------------------------------------
# - Desarrollo (rápido): SQLite (ya funciona con DATABASE_URL="file:./dev.db").
#
#   DATABASE_URL="postgresql://usuario:password@host:5432/nombredb?schema=public"

# 4) Generar secretos seguros
# ---------------------------
# Generar un `NEXTAUTH_SECRET` y `AUTH_SECRET` seguros. Ejemplo:
#
# bash/macOS/Linux:
#   openssl rand -base64 32
#
# powershell (Windows):
#   [System.Convert]::ToBase64String((New-Object Byte[](32)) | % { (Get-Random -Minimum 0 -Maximum 256) })

# Copia los valores generados dentro del `.env` en `NEXTAUTH_SECRET` y `AUTH_SECRET`.

# 5) Instalar dependencias, generar cliente Prisma y migrar
# --------------------------------------------------------
# En el servidor (desde la raíz del proyecto):
#
# Instalación:
#   npm install
#
# Generar/actualizar el cliente Prisma (si has cambiado schema):
#   npx prisma generate --schema=prisma/schema.prisma
#
# Crear / aplicar migraciones (desarrollo):
#   npx prisma migrate dev --name init --schema=prisma/schema.prisma
#
# Aplicar migraciones (producción):
#   npx prisma migrate deploy --schema=prisma/schema.prisma

# Nota: Si usas SQLite en producción, las migraciones con `migrate dev` funcionan,
# pero para entornos multi-instanacia o producción uso Postgres y `migrate deploy`.

# 6) Preparar carpeta de uploads
# ------------------------------
# La app guarda fotos en `public/uploads`. Asegúrate de crearla y dar permisos:
#
#   mkdir -p public/uploads
#   chown -R <usuario> public/uploads
#   chmod -R 755 public/uploads

# 7) Construir y ejecutar la app
# ------------------------------
# Desarrollo:
#   npm run dev
#
# Producción (con PM2 recomendado):
#   npm run build
#   # ejemplo con PM2
#   npm install -g pm2
#   pm2 start npm --name "portal-fincas" -- start

# Alternativa (systemd): crea un servicio que ejecute `npm start` con NODE_ENV=production.

# 8) Servir detrás de un reverse proxy (Nginx) y HTTPS
# ---------------------------------------------------
# - Configura Nginx para redirigir el tráfico a `http://localhost:3000` y manejar TLS.
# - Usa Certbot para obtener certificados Let's Encrypt.

# 9) Respaldo y mantenimiento
# ---------------------------
# - Haz backups regulares de la base de datos (si SQLite: copia del archivo dev.db).
# - Si usas Postgres: pg_dump programado con cron.
# - Mantén una estrategia de snapshots para el servidor y copia periódica de `public/uploads`.

# 10) Usuarios y administración
# -----------------------------
# - Puedes crear un usuario admin manualmente en la base de datos (INSERT) o usar
#   un script de seed si lo tienes en `prisma/seed.ts`.

# 11) Errores comunes y solución rápida
# ------------------------------------
# - Error al aplicar migraciones: revisa `DATABASE_URL` y `prisma/schema.prisma`.
# - Permisos de archivos: si no se pueden subir/eliminar imágenes, revisa permisos en `public/uploads`.
# - NextAuth cookies inválidas: revisa `NEXTAUTH_URL` y `NEXTAUTH_SECRET`.


# =========================
# EJEMPLO: CONFIGURACIÓN PRODUCCIÓN (COMENTADA)
# =========================
# DATABASE_URL="postgresql://usuario:password@host:5432/nombredb?schema=public"
# AUTH_SECRET='CAMBIAR_POR_UN_SECRETO_REAL'
# NEXTAUTH_URL="https://tudominio.com"
# NEXTAUTH_URL_INTERNAL="https://tudominio.com"
# NEXTAUTH_SECRET='CAMBIAR_POR_UN_SECRETO_REAL'
# NEXTAUTH_TRUSTED_HOSTS="tudominio.com"


# =========================
# COMANDOS ÚTILES (RESUMEN RÁPIDO)
# =========================
# Instalar dependencias:
#   npm install
# Generar cliente Prisma:
#   npx prisma generate --schema=prisma/schema.prisma
# Crear migración (dev):
#   npx prisma migrate dev --name <descripcion> --schema=prisma/schema.prisma
# Aplicar migraciones (prod):
#   npx prisma migrate deploy --schema=prisma/schema.prisma
# Ejecutar en desarrollo:
#   npm run dev
# Construir producción:
#   npm run build
# Iniciar (prod):
#   npm start

# ------------------------
# NOTAS FINALES
# ------------------------
# - Este archivo es una plantilla. Nunca subas tu `.env` real al control de versiones.
# - Protege los secretos (AUTH_SECRET, NEXTAUTH_SECRET, DATABASE_URL) con el gestor
#   de secretos de tu proveedor o variables de entorno de la máquina.

